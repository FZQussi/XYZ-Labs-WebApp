<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - XYZ Labs</title>
  <link rel="stylesheet" href="../css/base.css">
<link rel="stylesheet" href="../css/layout.css">
<link rel="stylesheet" href="../css/dashboard.css">
<link rel="stylesheet" href="../css/users.css">
<link rel="stylesheet" href="../css/products.css">
<link rel="stylesheet" href="../css/forms.css">
<link rel="stylesheet" href="../css/modals.css">
<link rel="stylesheet" href="../css/attributes.css">
<script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

</head>
<body>
  <aside class="sidebar">
    <h2>Admin</h2>
    <button data-tab="users">Utilizadores</button>
    <button data-tab="products">Produtos</button>
    
    <button id="logoutBtn">Logout</button>
  </aside>

  <main>
    <div id="welcomeMsg" class="welcome"></div>

    <!-- Substituir a sec√ß√£o de utilizadores no dashboard.html -->
<section id="users" class="tab hidden">
  <h2>Gest√£o de Utilizadores</h2>

  <!-- ESTAT√çSTICAS -->
  <div class="stats-container">
    <div class="stat-card">
      <div class="stat-icon">üë•</div>
      <div class="stat-info">
        <span class="stat-label">Total</span>
        <span class="stat-value" id="totalUsers">0</span>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon">üëë</div>
      <div class="stat-info">
        <span class="stat-label">Admins</span>
        <span class="stat-value" id="totalAdmins">0</span>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon">üìÖ</div>
      <div class="stat-info">
        <span class="stat-label">Novos (30d)</span>
        <span class="stat-value" id="newUsers">0</span>
      </div>
    </div>
  </div>

  <!-- FILTROS + A√á√ïES -->
  <div class="users-toolbar">
    <input
      type="text"
      id="userSearch"
      placeholder="Pesquisar por nome ou email..."
    />

    <select id="userFilterRole">
      <option value="">Todas as Roles</option>
      <option value="admin">Admin</option>
      <option value="user">User</option>
    </select>

    <button id="addUserBtn" class="primary-btn">
      + Novo Utilizador
    </button>
  </div>

  <!-- TABELA DE UTILIZADORES -->
  <div class="users-table">
    <div class="table-header">
      <span>Nome</span>
      <span>Email</span>
      <span>Role</span>
      <span>Data Registo</span>
      <span>A√ß√µes</span>
    </div>

    <div id="usersList" class="table-body">
      <!-- Utilizadores inseridos via JavaScript -->
    </div>
  </div>
</section>
<!-- ============ MODAL: CRIAR UTILIZADOR ============ -->
<div id="createUserModal" class="modal hidden">
  <div class="modal-content">
    <span class="close" data-close="createUser">&times;</span>

    <h3>Criar Novo Utilizador</h3>

    <form id="createUserForm">
      <div class="form-group">
        <label>Nome *</label>
        <input type="text" id="createUserName" required>
      </div>

      <div class="form-group">
        <label>Email *</label>
        <input type="email" id="createUserEmail" required>
      </div>

      <div class="form-group">
        <label>Password *</label>
        <input type="password" id="createUserPassword" required>
        <ul class="password-reqs">
          <li id="createLengthReq">‚â• 12 caracteres</li>
          <li id="createUppercaseReq">Uma letra mai√∫scula</li>
          <li id="createLowercaseReq">Uma letra min√∫scula</li>
          <li id="createNumberReq">Um n√∫mero</li>
          <li id="createSpecialReq">Um car√°cter especial</li>
        </ul>
      </div>

      <div class="form-group">
        <label>Role *</label>
        <select id="createUserRole" required>
          <option value="user">User</option>
          <option value="admin">Admin</option>
        </select>
      </div>

      <button type="submit" class="primary-btn">
        Criar Utilizador
      </button>
    </form>
  </div>
</div>

<!-- ============ MODAL: VER DETALHES ============ -->
<div id="viewUserModal" class="modal hidden">
  <div class="modal-content">
    <span class="close" data-close="viewUser">&times;</span>

    <h3>Detalhes do Utilizador</h3>

    <div class="user-details">
      <div class="detail-row">
        <span class="detail-label">Nome:</span>
        <span class="detail-value" id="viewUserName"></span>
      </div>

      <div class="detail-row">
        <span class="detail-label">Email:</span>
        <span class="detail-value" id="viewUserEmail"></span>
      </div>

      <div class="detail-row">
        <span class="detail-label">Role:</span>
        <span class="detail-value">
          <span id="viewUserRole" class="role-badge"></span>
        </span>
      </div>

      <div class="detail-row">
        <span class="detail-label">Registado em:</span>
        <span class="detail-value" id="viewUserCreated"></span>
      </div>
    </div>

    <div class="modal-actions">
      <button id="editUserFromViewBtn" class="primary-btn">
        ‚úèÔ∏è Editar
      </button>
      <button id="deleteUserFromViewBtn" class="danger-btn">
        üóëÔ∏è Eliminar
      </button>
    </div>
  </div>
</div>

<!-- ============ MODAL: EDITAR UTILIZADOR ============ -->
<div id="editUserModal" class="modal hidden">
  <div class="modal-content">
    <span class="close" data-close="editUser">&times;</span>

    <h3>Editar Utilizador</h3>

    <form id="editUserForm">
      <input type="hidden" id="editUserId">

      <div class="form-group">
        <label>Nome *</label>
        <input type="text" id="editUserName" required>
      </div>

      <div class="form-group">
        <label>Email *</label>
        <input type="email" id="editUserEmail" required>
      </div>

      <div class="form-group">
        <label>Role *</label>
        <select id="editUserRole" required>
          <option value="user">User</option>
          <option value="admin">Admin</option>
        </select>
      </div>

      <div class="form-group">
        <label>Nova Password (deixar vazio para n√£o alterar)</label>
        <input type="password" id="editUserPassword" placeholder="********">
        <ul class="password-reqs">
          <li id="editLengthReq">‚â• 12 caracteres</li>
          <li id="editUppercaseReq">Uma letra mai√∫scula</li>
          <li id="editLowercaseReq">Uma letra min√∫scula</li>
          <li id="editNumberReq">Um n√∫mero</li>
          <li id="editSpecialReq">Um car√°cter especial</li>
        </ul>
      </div>

      <div class="modal-actions">
        <button type="submit" class="primary-btn">
          üíæ Guardar Altera√ß√µes
        </button>
      </div>
    </form>
  </div>
</div>

 <!-- ABA DE PRODUTOS -->
<!-- ABA DE PRODUTOS - VERS√ÉO ATUALIZADA COM SELE√á√ÉO M√öLTIPLA -->
<section id="products" class="tab hidden">
  <h2>Gest√£o de Produtos</h2>

  <!-- FILTROS + A√á√ïES -->
  <div class="products-toolbar">
    <input
      type="text"
      id="productSearch"
      placeholder="Pesquisar produto..."
    />

    <select id="productFilterActive">
      <option value="">Todos</option>
      <option value="true">Ativos</option>
      <option value="false">Inativos</option>
    </select>
    
    <input type="number" id="priceMin" placeholder="Pre√ßo min ‚Ç¨" />
    <input type="number" id="priceMax" placeholder="Pre√ßo max ‚Ç¨" />

    <select id="productFilterStock">
      <option value="">Stock (Todos)</option>
      <option value="true">Dispon√≠vel</option>
      <option value="false">Indispon√≠vel</option>
    </select>

    <input
      type="text"
      id="productFilterCategory"
      placeholder="Filtrar por categoria..."
    />

    <input
      type="text"
      id="productFilterPrimaryCategory"
      placeholder="Categoria principal..."
    />

    <button id="addProductBtn" class="primary-btn">
      + Novo Produto
    </button>
  </div>

  <!-- BARRA DE A√á√ïES EM LOTE -->
  <div class="bulk-actions-bar">
    <div class="bulk-actions-left">
      <label class="select-all-container">
        <input type="checkbox" id="selectAllProducts">
        <span>Selecionar todos</span>
      </label>
      <span id="selectionCount" class="selection-count"></span>
    </div>
    <div class="bulk-actions-right">
      <button id="deleteSelectedBtn" class="danger-btn" disabled>
        üóëÔ∏è Eliminar Selecionados
      </button>
    </div>
  </div>

  <!-- TABELA DE PRODUTOS -->
  <div class="products-table">
    <div class="table-header">
      <span class="header-select"></span>
      <span>Nome</span>
      <span>Pre√ßo</span>
      <span>Stock</span>
      <span>Categorias</span>
      <span>Estado</span>
      <span>A√ß√µes</span>
    </div>

    <div id="productsList" class="table-body">
      <!-- Produtos inseridos via JavaScript -->
    </div>
  </div>
</section>

<!-- ================= MODAL: CRIAR PRODUTO ================= -->
<div id="createProductModal" class="modal hidden">
  <div class="modal-content">
    <span class="close" data-close="create">&times;</span>

    <h3>Novo Produto</h3>

    <form id="createProductForm">
      <div class="form-group">
        <label>Nome</label>
        <input type="text" id="createName" required>
      </div>

      <div class="form-group">
        <label>Pre√ßo (‚Ç¨)</label>
        <input type="number" id="createPrice" step="0.01" required>
      </div>

      <div class="form-group">
        <label>Descri√ß√£o</label>
        <textarea id="createDescription" rows="4" required></textarea>
      </div>
<div class="form-group">
  <label>Categorias *</label>
  <div id="categoriesCheckboxes" class="categories-checkbox-container">
    <!-- Categorias carregadas via JS -->
  </div>
  <small style="color:#666;font-size:12px;margin-top:5px;display:block;">
    Seleciona todas as categorias a que este produto pertence
  </small>
</div>

<!-- CATEGORIA PRINCIPAL -->
<div class="form-group">
  <label>Categoria Principal *</label>
  <select id="primaryCategory" disabled>
    <option value="">-- Categoria Principal --</option>
  </select>
  <small style="color:#666;font-size:12px;margin-top:5px;display:block;">
    Escolhe qual a categoria principal para breadcrumbs e navega√ß√£o
  </small>
</div>



      <div class="form-group checkbox-group">
  <label>
    <input type="checkbox" id="createStock">
    Produto dispon√≠vel
  </label>
</div>


      <div class="form-group">
  <label>Ficheiros 3D e Imagens</label>
  <input type="file" id="createModelFile" name="modelFile" accept=".glb">
<input type="file" id="createImages" name="images" accept="image/*" multiple>

  <small>Podes adicionar at√© 4 imagens.</small>
</div>


      <button type="submit" class="primary-btn">
        Criar Produto
      </button>
    </form>
  </div>
</div>

<!-- Substituir o modal editProductModal no dashboard.html -->
<div id="editProductModal" class="modal hidden">
  <div class="modal-content modal-large">
    <span class="close" data-close="edit">&times;</span>

    <h3>Editar Produto: <span id="editProductName"></span></h3>

    <!-- SISTEMA DE ABAS -->
    <div class="modal-tabs">
      <button class="modal-tab-btn active" data-tab="edit-details">
        üìã Detalhes
      </button>
      <button class="modal-tab-btn" data-tab="edit-model">
        üé® Modelo 3D
      </button>
      <button class="modal-tab-btn" data-tab="edit-images">
        üñºÔ∏è Imagens
      </button>
    </div>

    <!-- CONTE√öDO DAS ABAS -->
    <div class="modal-tabs-container">
      
      <!-- ABA: EDITAR DETALHES -->
      <div id="tab-edit-details" class="modal-tab-content active">
        <form id="editProductForm">
          <input type="hidden" id="editId">

          <div class="form-row">
            <div class="form-group">
              <label>Nome *</label>
              <input type="text" id="editName" required>
            </div>

            <div class="form-group">
              <label>Pre√ßo (‚Ç¨) *</label>
              <input type="number" id="editPrice" step="0.01" required>
            </div>
          </div>

          <div class="form-group">
            <label>Descri√ß√£o *</label>
            <textarea id="editDescription" rows="4" required></textarea>
          </div>

       <div class="form-group">
  <label>Categorias *</label>
  <div id="categoriesCheckboxes" class="categories-checkbox-container">
    <!-- Categorias carregadas via JS -->
  </div>
  <small style="color:#666;font-size:12px;margin-top:5px;display:block;">
    Seleciona todas as categorias a que este produto pertence
  </small>
</div>

<!-- CATEGORIA PRINCIPAL -->
<div class="form-group">
  <label>Categoria Principal *</label>
  <select id="primaryCategory" disabled>
    <option value="">-- Categoria Principal --</option>
  </select>
  <small style="color:#666;font-size:12px;margin-top:5px;display:block;">
    Escolhe qual a categoria principal para breadcrumbs e navega√ß√£o
  </small>
</div>

          <div class="form-group">
  <label>Stock Dispon√≠vel</label>
  <input type="checkbox" id="editStock">
</div>


          <div class="modal-actions">
            <button type="submit" class="primary-btn">
              üíæ Guardar Altera√ß√µes
            </button>
            <button type="button" id="deleteProductBtn" class="danger-btn">
              üóëÔ∏è Eliminar Produto
            </button>
          </div>
        </form>
      </div>

      <!-- ABA: EDITAR MODELO 3D -->
      <div id="tab-edit-model" class="modal-tab-content">
        <div class="model-edit-container">
          
          <!-- Modelo Atual -->
          <div class="current-model">
            <h4>Modelo Atual</h4>
            <model-viewer
              id="editCurrentModel"
              src="..."
              alt="Modelo 3D Atual"
              auto-rotate
              camera-controls
              shadow-intensity="1"
              style="width:100%; background-color:#2c2c2c; border-radius:8px;"
            ></model-viewer>
            <p class="model-filename" id="currentModelFilename"></p>
          </div>

          <!-- Upload Novo Modelo -->
          <div class="upload-model">
            <h4>Substituir Modelo</h4>
            <div class="upload-area">
              <input type="file" id="editModelFile" accept=".glb" style="display:none;">
              <button type="button" class="secondary-btn" onclick="document.getElementById('editModelFile').click()">
                üìÅ Escolher Ficheiro .GLB
              </button>
              <p id="newModelFilename" class="file-selected"></p>
            </div>
            <button type="button" id="uploadNewModelBtn" class="primary-btn" disabled>
              ‚¨ÜÔ∏è Enviar Novo Modelo
            </button>
          </div>

        </div>
      </div>

      <!-- ABA: EDITAR IMAGENS -->
      <div id="tab-edit-images" class="modal-tab-content">
        
        <!-- Imagens Atuais -->
        <div class="current-images-section">
          <h4>Imagens Atuais (<span id="imageCount">0</span>/4)</h4>
          <div id="editImagesGrid" class="images-grid-edit">
            <!-- Imagens inseridas via JS -->
          </div>
        </div>

        <!-- Upload Novas Imagens -->
        <div class="upload-images-section">
          <h4>Adicionar Novas Imagens</h4>
          <div class="upload-area">
            <input type="file" id="editNewImages" accept="image/*" multiple style="display:none;">
            <button type="button" class="secondary-btn" onclick="document.getElementById('editNewImages').click()">
              üìÅ Escolher Imagens
            </button>
            <p id="newImagesInfo" class="file-selected"></p>
          </div>
          <button type="button" id="uploadNewImagesBtn" class="primary-btn" disabled>
            ‚¨ÜÔ∏è Adicionar Imagens
          </button>
        </div>

        <!-- Substituir Todas -->
        <div class="replace-images-section">
          <h4>Substituir Todas as Imagens</h4>
          <div class="upload-area">
            <input type="file" id="editReplaceImages" accept="image/*" multiple style="display:none;">
            <button type="button" class="secondary-btn" onclick="document.getElementById('editReplaceImages').click()">
              üìÅ Escolher Novas Imagens (at√© 4)
            </button>
            <p id="replaceImagesInfo" class="file-selected"></p>
          </div>
          <button type="button" id="replaceAllImagesBtn" class="danger-btn" disabled>
            üîÑ Substituir Todas
          </button>
          <small class="warning-text">‚ö†Ô∏è Isto ir√° eliminar todas as imagens atuais permanentemente!</small>
        </div>

      </div>

    </div>
  </div>
</div>
<!-- Substituir o modal viewProductModal no dashboard.html -->
<div id="viewProductModal" class="modal hidden">
  <div class="modal-content modal-large">
    <span class="close" data-close="view">&times;</span>

    <h3 id="viewName"></h3>

    <!-- SISTEMA DE ABAS -->
    <div class="modal-tabs">
      <button class="modal-tab-btn active" data-tab="details">
        üìã Detalhes
      </button>
      <button class="modal-tab-btn" data-tab="model">
        üé® Modelo 3D
      </button>
      <button class="modal-tab-btn" data-tab="images">
        üñºÔ∏è Imagens
      </button>
    </div>

    <!-- CONTE√öDO DAS ABAS -->
    <div class="modal-tabs-container">
      
      <!-- ABA: DETALHES -->
      <div id="tab-details" class="modal-tab-content active">
        <div class="product-details-grid">
          <div class="detail-row">
            <span class="detail-label">Pre√ßo:</span>
            <span class="detail-value">‚Ç¨<span id="viewPrice"></span></span>
          </div>
          
          <div class="detail-row">
            <span class="detail-label">Stock:</span>
            <span class="detail-value"><span id="viewStock"></span></span>
          </div>
          
          <div class="detail-row">
            <span class="detail-label">Estado:</span>
            <span class="detail-value"><span id="viewStatus"></span></span>
          </div>
          
          <div class="detail-row">
            <span class="detail-label">Categoria:</span>
            <span class="detail-value"><span id="viewCategory"></span></span>
          </div>
          
          <div class="detail-row">
            <span class="detail-label">Subcategoria:</span>
            <span class="detail-value"><span id="viewSubcategory"></span></span>
          </div>
          
          <div class="detail-row full-width">
            <span class="detail-label">Descri√ß√£o:</span>
            <p class="detail-description" id="viewDescription"></p>
          </div>
        </div>
      </div>

      <!-- ABA: MODELO 3D -->
      <div id="tab-model" class="modal-tab-content">
        <div class="model-viewer-container">
          <model-viewer
            id="viewModel"
            src="..."
            alt="Modelo 3D"
            auto-rotate
            camera-controls
            shadow-intensity="1"
            style="width:100%; background-color:#2c2c2c; border-radius:8px;"
          ></model-viewer>
          <div class="model-controls">
            <p>üñ±Ô∏è Arrasta para rodar | üîç Scroll para zoom</p>
          </div>
        </div>
      </div>

      <!-- ABA: IMAGENS -->
      <div id="tab-images" class="modal-tab-content">
        <div id="imagesGrid" class="images-grid">
          <!-- Imagens ser√£o inseridas via JavaScript -->
        </div>
      </div>

    </div>
  </div>
</div>


      </div>
    </div>
  </div>
</div>

  </main>


  <script src="../scripts/dashboard.js"></script>
  <script src="../scripts/users.js"></script>
  <script src="../scripts/products.js"></script>
  <script src="../scripts/categories.js"></script>
 
  <script src="../scripts/createproduct.js"></script>
  <script src="../scripts/editproduct.js"></script>
  <script src="../scripts/viewproduct.js"></script>
</body>
</html>
