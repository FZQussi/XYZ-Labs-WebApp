<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - XYZ Labs</title>
  <link rel="stylesheet" href="../css/base.css">
  <link rel="stylesheet" href="../css/layout.css">
  <link rel="stylesheet" href="../css/dashboard.css">
  <link rel="stylesheet" href="../css/users.css">
  <link rel="stylesheet" href="../css/products.css">
  <link rel="stylesheet" href="../css/forms.css">
  <link rel="stylesheet" href="../css/modals.css">
  <link rel="stylesheet" href="../css/attributes.css">
  <link rel="stylesheet" href="../css/image-order-manager.css">
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
</head>
<body>
  <aside class="sidebar">
    <h2>Admin</h2>
    <button data-tab="users">Utilizadores</button>
    <button data-tab="products">Produtos</button>
    <button id="logoutBtn">Logout</button>
  </aside>

  <main>
    <div id="welcomeMsg" class="welcome"></div>

    <!-- SEC√á√ÉO DE UTILIZADORES -->
    <section id="users" class="tab hidden">
      <h2>Gest√£o de Utilizadores</h2>
      <!-- ... conte√∫do omitido por brevidade ... -->
    </section>

    <!-- SEC√á√ÉO DE PRODUTOS -->
    <section id="products" class="tab hidden">
      <h2>Gest√£o de Produtos</h2>

      <!-- FILTROS + A√á√ïES -->
      <div class="products-toolbar">
        <input type="text" id="productSearch" placeholder="Pesquisar produto..." />
        <select id="productFilterActive">
          <option value="">Todos</option>
          <option value="true">Ativos</option>
          <option value="false">Inativos</option>
        </select>
        <input type="number" id="priceMin" placeholder="Pre√ßo min ‚Ç¨" />
        <input type="number" id="priceMax" placeholder="Pre√ßo max ‚Ç¨" />
        <select id="productFilterStock">
          <option value="">Stock (Todos)</option>
          <option value="true">Dispon√≠vel</option>
          <option value="false">Indispon√≠vel</option>
        </select>
        <input type="text" id="productFilterCategory" placeholder="Filtrar por categoria..." />
        <input type="text" id="productFilterPrimaryCategory" placeholder="Categoria principal..." />
        <button id="addProductBtn" class="primary-btn">+ Novo Produto</button>
      </div>

      <!-- TABELA DE PRODUTOS -->
      <div class="products-table">
        <div class="table-header">
          <span>Nome</span>
          <span>Pre√ßo</span>
          <span>Stock</span>
          <span>Categorias</span>
          <span>Estado</span>
          <span>A√ß√µes</span>
        </div>
        <div id="productsList" class="table-body"></div>
      </div>
    </section>

    <!-- MODAL: CRIAR PRODUTO -->
    <div id="createProductModal" class="modal hidden">
      <div class="modal-content">
        <span class="close" data-close="create">&times;</span>
        <h3>Criar Novo Produto</h3>
        <form id="createProductForm">
          <!-- ... campos do formul√°rio ... -->
        </form>
      </div>
    </div>

    <!-- MODAL: EDITAR PRODUTO -->
    <div id="editProductModal" class="modal hidden">
      <div class="modal-content modal-large">
        <span class="close" data-close="edit">&times;</span>
        <h3>Editar Produto: <span id="editProductName"></span></h3>

        <!-- SISTEMA DE ABAS -->
        <div class="modal-tabs">
          <button class="modal-tab-btn active" data-tab="edit-details">üìã Detalhes</button>
          <button class="modal-tab-btn" data-tab="edit-model">üé® Modelo 3D</button>
          <button class="modal-tab-btn" data-tab="edit-images">üñºÔ∏è Imagens</button>
        </div>

        <!-- CONTE√öDO DAS ABAS -->
        <div class="modal-tabs-container">
          
          <!-- ABA: EDITAR DETALHES -->
          <div id="tab-edit-details" class="modal-tab-content active">
            <form id="editProductForm">
              <input type="hidden" id="editId">
              <div class="form-row">
                <div class="form-group">
                  <label>Nome *</label>
                  <input type="text" id="editName" required>
                </div>
                <div class="form-group">
                  <label>Pre√ßo (‚Ç¨) *</label>
                  <input type="number" id="editPrice" step="0.01" required>
                </div>
              </div>
              <div class="form-group">
                <label>Descri√ß√£o *</label>
                <textarea id="editDescription" rows="4" required></textarea>
              </div>
              <div class="form-group">
                <label>Categorias *</label>
                <div id="categoriesCheckboxes" class="categories-checkbox-container"></div>
                <small style="color:#666;font-size:12px;margin-top:5px;display:block;">
                  Seleciona todas as categorias a que este produto pertence
                </small>
              </div>
              <div class="form-group">
                <label>Categoria Principal *</label>
                <select id="primaryCategory" disabled>
                  <option value="">-- Categoria Principal --</option>
                </select>
                <small style="color:#666;font-size:12px;margin-top:5px;display:block;">
                  Escolhe qual a categoria principal para breadcrumbs e navega√ß√£o
                </small>
              </div>
              <div class="form-group">
                <label>Stock Dispon√≠vel</label>
                <input type="checkbox" id="editStock">
              </div>
              <div class="modal-actions">
                <button type="submit" class="primary-btn">üíæ Guardar Altera√ß√µes</button>
                <button type="button" id="deleteProductBtn" class="danger-btn">üóëÔ∏è Eliminar Produto</button>
              </div>
            </form>
          </div>

          <!-- ABA: EDITAR MODELO 3D -->
          <div id="tab-edit-model" class="modal-tab-content">
            <div class="model-edit-container">
              <div class="current-model">
                <h4>Modelo Atual</h4>
                <model-viewer
                  id="editCurrentModel"
                  src="..."
                  alt="Modelo 3D Atual"
                  auto-rotate
                  camera-controls
                  shadow-intensity="1"
                  style="width:100%; height:400px; background-color:#2c2c2c; border-radius:8px;"
                ></model-viewer>
                <p class="model-filename" id="currentModelFilename"></p>
              </div>
              <div class="upload-model">
                <h4>Substituir Modelo</h4>
                <div class="upload-area">
                  <input type="file" id="editModelFile" accept=".glb" style="display:none;">
                  <button type="button" class="secondary-btn" onclick="document.getElementById('editModelFile').click()">
                    üìÅ Escolher Ficheiro .GLB
                  </button>
                  <p id="newModelFilename" class="file-selected"></p>
                </div>
                <button type="button" id="uploadNewModelBtn" class="primary-btn" disabled>
                  ‚¨ÜÔ∏è Enviar Novo Modelo
                </button>
              </div>
            </div>
          </div>

          <!-- ABA: EDITAR IMAGENS (COM ORDENA√á√ÉO) -->
          <div id="tab-edit-images" class="modal-tab-content">
            <div class="image-order-instructions">
              <strong>üñºÔ∏è Gest√£o de Imagens</strong>
              <ul>
                <li><strong>Arrasta</strong> as imagens para reordenar</li>
                <li>Usa os <strong>bot√µes ‚Üë ‚Üì</strong> para mover</li>
                <li>A <strong>primeira imagem</strong> ser√° a principal</li>
                <li>M√°ximo de <strong>4 imagens</strong></li>
              </ul>
            </div>
            <div id="editImagesOrderContainer" class="image-order-container"></div>
            <div style="margin-top: 12px; text-align: center;">
              <span id="editImageCount" class="image-order-count">0/4 imagens</span>
            </div>
            <hr style="margin: 24px 0; border: 1px solid #ddd;">
            <div class="upload-images-section">
              <h4>‚ûï Adicionar Novas Imagens</h4>
              <div class="image-order-upload-area">
                <input type="file" id="editNewImagesInput" accept="image/*" multiple>
                <label for="editNewImagesInput" class="image-order-upload-btn">üìÅ Escolher Imagens</label>
                <span id="newImagesLabel" style="font-size: 13px; color: #666;">Nenhum ficheiro selecionado</span>
              </div>
              <button type="button" id="btnAddNewImages" class="primary-btn" style="margin-top: 12px;">‚¨ÜÔ∏è Enviar Imagens</button>
            </div>
            <hr style="margin: 24px 0; border: 1px solid #ddd;">
            <button type="button" id="btnSaveImageOrder" class="btn-save-image-order">üíæ Guardar Ordem das Imagens</button>
            <small style="display: block; margin-top: 12px; color: #666; text-align: center;">
              ‚ö†Ô∏è N√£o te esque√ßas de guardar a ordem depois de reordenar!
            </small>
          </div>

        </div>
      </div>
    </div>

    <!-- ‚úÖ MODAL: VER PRODUTO (COMPLETO) -->
    <div id="viewProductModal" class="modal hidden">
      <div class="modal-content modal-large">
        <span class="close" data-close="view">&times;</span>
        <h3 id="viewName"></h3>

        <div class="modal-tabs">
          <button class="modal-tab-btn active" data-tab="details">üìã Detalhes</button>
          <button class="modal-tab-btn" data-tab="model">üé® Modelo 3D</button>
          <button class="modal-tab-btn" data-tab="images">üñºÔ∏è Imagens</button>
        </div>

        <div class="modal-tabs-container">
          
          <div id="tab-details" class="modal-tab-content active">
            <div class="product-details-grid">
              <div class="detail-row">
                <span class="detail-label">Pre√ßo:</span>
                <span class="detail-value">‚Ç¨<span id="viewPrice"></span></span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Stock:</span>
                <span class="detail-value"><span id="viewStock"></span></span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Estado:</span>
                <span class="detail-value"><span id="viewStatus"></span></span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Categoria:</span>
                <span class="detail-value"><span id="viewCategory"></span></span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Subcategoria:</span>
                <span class="detail-value"><span id="viewSubcategory"></span></span>
              </div>
              <div class="detail-row full-width">
                <span class="detail-label">Descri√ß√£o:</span>
                <p class="detail-description" id="viewDescription"></p>
              </div>
            </div>
          </div>

          <div id="tab-model" class="modal-tab-content">
            <div class="model-viewer-container">
              <model-viewer
                id="viewModel"
                src="..."
                alt="Modelo 3D"
                auto-rotate
                camera-controls
                shadow-intensity="1"
                style="width:100%; height:500px; background-color:#2c2c2c; border-radius:8px;"
              ></model-viewer>
              <div class="model-controls">
                <p>üñ±Ô∏è Arrasta para rodar | üîç Scroll para zoom</p>
              </div>
            </div>
          </div>

          <div id="tab-images" class="modal-tab-content">
            <div id="imagesGrid" class="images-grid"></div>
          </div>

        </div>
      </div>
    </div>

  </main>

  <!-- Scripts -->
  <script src="../scripts/image-order-manager.js"></script>
  <script src="../scripts/dashboard.js"></script>
  <script src="../scripts/users.js"></script>
  <script src="../scripts/products.js"></script>
  <script src="../scripts/categories.js"></script>
  <script src="../scripts/createproduct.js"></script>
  <script src="../scripts/editproduct.js"></script>
  <script src="../scripts/viewproduct.js"></script>
</body>
</html>