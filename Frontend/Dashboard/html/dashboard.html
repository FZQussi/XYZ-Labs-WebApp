<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - XYZ Labs</title>
  <link rel="stylesheet" href="/Dashboard/css/dashboard-brutalist.css">
  <link rel="stylesheet" href="/Dashboard/css/products-modals.css">
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

  <style>
    /* ===== RICH TEXT EDITOR ===== */
    .rich-editor-toolbar {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      padding: 8px;
      background: #f5f5f5;
      border: 2px solid #000;
      border-bottom: none;
    }
    .rich-editor-toolbar button {
      padding: 4px 10px;
      background: #fff;
      border: 2px solid #000;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.1s;
    }
    .rich-editor-toolbar button:hover { background: #000; color: #fff; }
    .rich-editor-toolbar .separator { width: 1px; background: #ccc; margin: 0 4px; }
    .rich-editor-content {
      min-height: 180px;
      max-height: 320px;
      overflow-y: auto;
      padding: 12px;
      border: 2px solid #000;
      font-size: 14px;
      line-height: 1.6;
      outline: none;
      background: #fff;
    }
    .rich-editor-content:focus { border-color: #2563eb; }
    .rich-editor-content h2 { font-size: 1.3em; margin: 8px 0 4px; }
    .rich-editor-content h3 { font-size: 1.1em; margin: 8px 0 4px; }
    .rich-editor-content ul, .rich-editor-content ol { padding-left: 24px; margin: 6px 0; }
    .rich-editor-content blockquote {
      border-left: 4px solid #2563eb;
      margin: 8px 0;
      padding: 6px 12px;
      background: #eff6ff;
      font-style: italic;
    }
    .rich-editor-preview {
      border: 2px solid #e5e7eb;
      padding: 12px;
      margin-top: 8px;
      font-size: 13px;
      background: #fafafa;
      line-height: 1.6;
    }
    .rich-editor-preview h2 { font-size: 1.2em; margin: 6px 0; }
    .rich-editor-preview h3 { font-size: 1.05em; margin: 5px 0; }
    .rich-editor-preview blockquote {
      border-left: 4px solid #2563eb;
      padding: 4px 12px;
      margin: 6px 0;
      background: #eff6ff;
      font-style: italic;
    }

    /* ===== CATEGORY SELECTORS ===== */
    .primary-cat-select {
      width: 100%;
      padding: 10px;
      border: 2px solid #000;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      font-weight: bold;
      background: #fff;
      cursor: pointer;
    }
    .primary-cat-select:focus { border-color: #2563eb; outline: none; }

    .secondary-cats-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
    }
    .sec-cat-checkbox {
      display: flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
    }
    .sec-cat-checkbox input { display: none; }
    .sec-cat-badge {
      padding: 5px 12px;
      border: 2px solid #000;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      font-weight: bold;
      background: #fff;
      cursor: pointer;
      transition: background 0.1s;
      user-select: none;
    }
    .sec-cat-checkbox input:checked + .sec-cat-badge {
      background: #000;
      color: #fff;
    }
    .sec-cat-badge.role-tag { border-style: dashed; }

    /* ===== CATEGORIES TAB ===== */
    .categories-layout {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
    }
    @media (max-width: 900px) { .categories-layout { grid-template-columns: 1fr; } }
    .cat-section-card {
      border: 3px solid #000;
      background: #fff;
      box-shadow: 4px 4px 0 #000;
    }
    .cat-section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 16px;
      background: #000;
      color: #fff;
      font-family: 'Courier New', monospace;
      font-weight: bold;
      font-size: 14px;
    }
    .category-row {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 16px;
      border-bottom: 1px solid #eee;
      font-family: 'Courier New', monospace;
      font-size: 13px;
    }
    .category-row:last-child { border-bottom: none; }
    .cat-icon { font-size: 20px; min-width: 28px; text-align: center; }
    .cat-name { font-weight: bold; flex: 1; }
    .cat-desc { color: #666; font-size: 12px; flex: 2; }
    .cat-order { color: #aaa; font-size: 11px; min-width: 32px; }
    .cat-actions { display: flex; gap: 6px; }
    .cat-role-badge {
      padding: 3px 8px;
      border: 2px solid #000;
      font-size: 11px;
      font-weight: bold;
      white-space: nowrap;
    }
    .role-tag { border-style: dashed; background: #fefce8; }
    .role-secondary { background: #eff6ff; }

    /* Description render in view modal */
    .desc-rendered { line-height: 1.7; font-size: 14px; }
    .desc-rendered h2 { font-size: 1.2em; margin: 8px 0 4px; }
    .desc-rendered h3 { font-size: 1.05em; margin: 6px 0 3px; }
    .desc-rendered blockquote {
      border-left: 4px solid #2563eb;
      padding: 4px 12px;
      margin: 8px 0;
      background: #eff6ff;
      font-style: italic;
    }
    .desc-rendered ul, .desc-rendered ol { padding-left: 22px; margin: 6px 0; }

    /* Secondary cats in view */
    .sec-cats-view { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 4px; }
    .sec-cats-view .sec-cat-badge {
      padding: 3px 10px;
      font-size: 12px;
      background: #f5f5f5;
    }
  </style>
</head>
<body>
  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <h1>XYZ LABS</h1>
      <span class="admin-badge">ADMIN</span>
    </div>

    <nav class="sidebar-nav">
      <button data-tab="dashboard" class="nav-btn active">
        <span class="nav-icon">üìä</span>
        <span>Dashboard</span>
      </button>
      <button data-tab="users" class="nav-btn">
        <span class="nav-icon">üë•</span>
        <span>Utilizadores</span>
      </button>
      <button data-tab="products" class="nav-btn">
        <span class="nav-icon">üì¶</span>
        <span>Produtos</span>
      </button>
      <button data-tab="categories" class="nav-btn">
        <span class="nav-icon">üìÇ</span>
        <span>Categorias</span>
      </button>
      <button data-tab="orders" class="nav-btn">
        <span class="nav-icon">üìã</span>
        <span>Encomendas</span>
      </button>
      <button data-tab="priceCalculator" class="nav-btn">
        <span class="nav-icon">üßÆ</span>
        <span>Calculadora Pre√ßos</span>
      </button>
    </nav>

    <div class="sidebar-footer">
      <div class="user-info" id="userInfo">
        <div class="user-avatar">üë§</div>
        <div class="user-details">
          <span class="user-name" id="userName">Admin</span>
          <span class="user-role">Administrator</span>
        </div>
      </div>
      <button id="logoutBtn" class="logout-btn">
        <span>üö™</span>
        <span>LOGOUT</span>
      </button>
    </div>
  </aside>

  <!-- MAIN CONTENT -->
  <main class="main-content">

    <!-- ============ DASHBOARD PRINCIPAL ============ -->
    <section id="dashboard" class="tab">
      <header class="page-header">
        <h2 class="page-title">DASHBOARD</h2>
        <div class="page-actions">
          <button id="refreshDashboard" class="btn-icon" title="Atualizar">üîÑ</button>
          <span class="last-update">√öltima atualiza√ß√£o: <span id="lastUpdate">--:--</span></span>
        </div>
      </header>

      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-header"><span class="stat-icon">üì¶</span><span class="stat-trend" id="productsTrend">‚Äî</span></div>
          <div class="stat-body"><h3 class="stat-value" id="totalProducts">0</h3><p class="stat-label">Total Produtos</p></div>
          <div class="stat-footer"><span id="activeProducts">0</span> ativos</div>
        </div>
        <div class="stat-card">
          <div class="stat-header"><span class="stat-icon">üë•</span><span class="stat-trend" id="usersTrend">‚Äî</span></div>
          <div class="stat-body"><h3 class="stat-value" id="totalUsersStats">0</h3><p class="stat-label">Utilizadores</p></div>
          <div class="stat-footer"><span id="newUsersStats">0</span> novos (30d)</div>
        </div>
        <div class="stat-card">
          <div class="stat-header"><span class="stat-icon">üìÇ</span><span class="stat-trend">‚Äî</span></div>
          <div class="stat-body"><h3 class="stat-value" id="totalCategories">0</h3><p class="stat-label">Categorias</p></div>
          <div class="stat-footer">Sistema de categoriza√ß√£o</div>
        </div>
        <div class="stat-card">
          <div class="stat-header"><span class="stat-icon">üîê</span><span class="stat-trend stat-positive">‚úì</span></div>
          <div class="stat-body"><h3 class="stat-value">ATIVO</h3><p class="stat-label">Seguran√ßa</p></div>
          <div class="stat-footer">Sess√£o segura</div>
        </div>
      </div>

      <div class="dashboard-grid">
        <div class="dashboard-card">
          <div class="card-header"><h3 class="card-title">ATIVIDADE RECENTE</h3><button class="btn-card-action">Ver tudo</button></div>
          <div class="card-body"><div id="recentActivity" class="activity-list"><div class="activity-item"><div class="activity-icon">‚è≥</div><div class="activity-details"><p class="activity-text">A carregar atividades...</p></div></div></div></div>
        </div>
        <div class="dashboard-card">
          <div class="card-header"><h3 class="card-title">PRODUTOS RECENTES</h3><button class="btn-card-action">Gerir</button></div>
          <div class="card-body"><div id="recentProducts" class="products-preview"><div class="loading-state">A carregar produtos...</div></div></div>
        </div>
        <div class="dashboard-card">
          <div class="card-header"><h3 class="card-title">STOCK</h3></div>
          <div class="card-body">
            <div class="stock-stats">
              <div class="stock-item"><span class="stock-label">Dispon√≠vel</span><span class="stock-value stock-available" id="stockAvailable">0</span></div>
              <div class="stock-item"><span class="stock-label">Indispon√≠vel</span><span class="stock-value stock-unavailable" id="stockUnavailable">0</span></div>
              <div class="stock-progress"><div class="stock-bar" id="stockBar" style="width: 0%"></div></div>
            </div>
          </div>
        </div>
        <div class="dashboard-card">
          <div class="card-header"><h3 class="card-title">A√á√ïES R√ÅPIDAS</h3></div>
          <div class="card-body">
            <div class="quick-actions">
              <button class="quick-action-btn" data-action="add-product"><span class="action-icon">‚ûï</span><span class="action-label">Novo Produto</span></button>
              <button class="quick-action-btn" data-action="add-user"><span class="action-icon">üë§</span><span class="action-label">Novo Utilizador</span></button>
              <button class="quick-action-btn" data-action="view-products"><span class="action-icon">üì¶</span><span class="action-label">Ver Produtos</span></button>
              <button class="quick-action-btn" data-action="view-users"><span class="action-icon">üë•</span><span class="action-label">Ver Utilizadores</span></button>
            </div>
          </div>
        </div>
      </div>

      <div class="alerts-section" id="dashboardAlerts"></div>
    </section>

    <!-- ============ UTILIZADORES ============ -->
    <section id="users" class="tab hidden">
      <header class="page-header"><h2 class="page-title">GEST√ÉO DE UTILIZADORES</h2></header>
      <div class="stats-bar">
        <div class="stat-item"><span class="stat-icon">üë•</span><div><span class="stat-label">Total</span><span class="stat-value" id="totalUsers">0</span></div></div>
        <div class="stat-item"><span class="stat-icon">üëë</span><div><span class="stat-label">Admins</span><span class="stat-value" id="totalAdmins">0</span></div></div>
        <div class="stat-item"><span class="stat-icon">üìÖ</span><div><span class="stat-label">Novos (30d)</span><span class="stat-value" id="newUsers">0</span></div></div>
      </div>
      <div class="toolbar">
        <input type="text" id="userSearch" placeholder="Pesquisar por nome ou email..." class="search-input">
        <select id="userFilterRole" class="filter-select">
          <option value="">Todas as Roles</option>
          <option value="admin">Admin</option>
          <option value="user">User</option>
        </select>
        <button id="addUserBtn" class="btn-primary"><span>‚ûï</span><span>NOVO UTILIZADOR</span></button>
      </div>
      <div class="data-table">
        <div class="table-header"><span>NOME</span><span>EMAIL</span><span>ROLE</span><span>DATA REGISTO</span><span>A√á√ïES</span></div>
        <div id="usersList" class="table-body"></div>
      </div>
    </section>

    <!-- ============ PRODUTOS ============ -->
    <section id="products" class="tab hidden">
      <header class="page-header"><h2 class="page-title">GEST√ÉO DE PRODUTOS</h2></header>
      <div class="toolbar">
        <input type="text" id="productSearch" placeholder="Pesquisar produto..." class="search-input">
        <select id="productFilterActive" class="filter-select">
          <option value="">Todos</option>
          <option value="true">Ativos</option>
          <option value="false">Inativos</option>
        </select>
        <input type="number" id="priceMin" placeholder="Pre√ßo min ‚Ç¨" class="filter-input">
        <input type="number" id="priceMax" placeholder="Pre√ßo max ‚Ç¨" class="filter-input">
        <select id="productFilterStock" class="filter-select">
          <option value="">Stock (Todos)</option>
          <option value="true">Dispon√≠vel</option>
          <option value="false">Indispon√≠vel</option>
        </select>
        <input type="text" id="productFilterCategory" placeholder="Categoria principal..." class="filter-input">
        <button id="addProductBtn" class="btn-primary"><span>‚ûï</span><span>NOVO PRODUTO</span></button>
      </div>
      <div class="data-table">
        <div class="table-header"><span>NOME</span><span>PRE√áO</span><span>STOCK</span><span>CAT. PRINCIPAL</span><span>ESTADO</span><span>A√á√ïES</span></div>
        <div id="productsList" class="table-body"></div>
      </div>
    </section>

    <!-- ============ CATEGORIAS ============ -->
    <section id="categories" class="tab hidden">
      <header class="page-header">
        <h2 class="page-title">GEST√ÉO DE CATEGORIAS</h2>
      </header>

      <div class="categories-layout">

        <!-- CATEGORIAS PRIM√ÅRIAS -->
        <div class="cat-section-card">
          <div class="cat-section-header">
            <span>üéØ CATEGORIAS PRINCIPAIS</span>
            <button id="addPrimaryCategoryBtn" class="btn-primary" style="font-size:12px;padding:6px 12px;">‚ûï Nova</button>
          </div>
          <div style="padding: 8px 0; font-family: 'Courier New', monospace; font-size: 12px; color: #666; padding: 8px 16px; border-bottom: 1px solid #eee;">
            Cada produto <strong>deve ter exatamente uma</strong> categoria principal.
          </div>
          <div id="primaryCategoriesList" style="min-height:80px;">
            <div class="loading-state" style="padding:16px">‚è≥ A carregar...</div>
          </div>
        </div>

        <!-- CATEGORIAS SECUND√ÅRIAS -->
        <div class="cat-section-card">
          <div class="cat-section-header">
            <span>üè∑Ô∏è CATEGORIAS SECUND√ÅRIAS / TAGS</span>
            <button id="addSecondaryCategoryBtn" class="btn-primary" style="font-size:12px;padding:6px 12px;">‚ûï Nova</button>
          </div>
          <div style="padding: 8px 16px; font-family: 'Courier New', monospace; font-size: 12px; color: #666; border-bottom: 1px solid #eee;">
            Podem ser <strong>materiais, tags</strong> ou qualquer atributo adicional.
          </div>
          <div id="secondaryCategoriesList" style="min-height:80px;">
            <div class="loading-state" style="padding:16px">‚è≥ A carregar...</div>
          </div>
        </div>

      </div>
    </section>

    <!-- ============ ENCOMENDAS ============ -->
    <section id="orders" class="tab hidden">
      <header class="page-header">
        <h2 class="page-title">GEST√ÉO DE ENCOMENDAS</h2>
        <div class="page-actions"><button id="ordersRefreshBtn" class="btn-icon" title="Atualizar">üîÑ</button></div>
      </header>
      <div class="stats-bar" style="margin-bottom:24px">
        <div class="stat-item"><span class="stat-icon">üìã</span><div><span class="stat-label">Total</span><span class="stat-value" id="ordersStatTotal">‚Äî</span></div></div>
        <div class="stat-item"><span class="stat-icon">‚è≥</span><div><span class="stat-label">Pendentes</span><span class="stat-value" id="ordersStatPending">‚Äî</span></div></div>
        <div class="stat-item"><span class="stat-icon">üí∂</span><div><span class="stat-label">Receita Total</span><span class="stat-value" id="ordersStatRevenue">‚Äî</span></div></div>
        <div class="stat-item"><span class="stat-icon">üìÖ</span><div><span class="stat-label">Este M√™s</span><span class="stat-value" id="ordersStatMonth">‚Äî</span></div></div>
      </div>
      <div class="toolbar">
        <input type="text" id="orderSearch" placeholder="Pesquisar por nome, email ou #id..." class="search-input">
        <select id="orderStatusFilter" class="filter-select" style="min-width:160px;flex:0">
          <option value="">Todos os estados</option>
          <option value="pending">Pendente</option>
          <option value="confirmed">Confirmado</option>
          <option value="printing">Em Impress√£o</option>
          <option value="shipped">Enviado</option>
          <option value="delivered">Entregue</option>
          <option value="cancelled">Cancelado</option>
        </select>
        <input type="date" id="orderDateFrom" class="filter-input" style="flex:0;min-width:140px" title="De">
        <input type="date" id="orderDateTo" class="filter-input" style="flex:0;min-width:140px" title="At√©">
      </div>
      <div class="data-table">
        <div class="table-header orders-table-header">
          <span>#ID</span><span>CLIENTE</span><span>DATA</span><span>ESTADO</span><span>TOTAL</span><span>TRACKING</span><span>A√á√ïES</span>
        </div>
        <div id="ordersList" class="table-body"><div class="orders-loading">A carregar encomendas...</div></div>
      </div>
      <div id="ordersPagination" class="orders-pagination"></div>
    </section>

    <!-- ============ CALCULADORA ============ -->
  <section id="priceCalculator" class="tab hidden">
  <header class="page-header">
    <h2 class="page-title">üßÆ CALCULADORA DE PRE√áOS ‚Äî IMPRESS√ÉO 3D</h2>
    <div class="page-actions">
      <button id="resetCalcBtn" class="btn-icon" title="Reset">üîÑ</button>
    </div>
  </header>

  <div class="calc-layout">

    <!-- ===== COLUNA ESQUERDA: INPUTS ===== -->
    <div class="calc-inputs-col">

      <!-- PROJECT DETAILS -->
      <div class="calc-card">
        <div class="calc-card-header">
          <span class="calc-card-icon">üìã</span>
          <h3>DETALHES DO PROJETO</h3>
        </div>
        <div class="calc-card-body">
          <div class="form-group">
            <label>Nome da Pe√ßa</label>
            <input type="text" id="calcPartName" placeholder="Ex: Suporte para c√¢mara">
          </div>
          <div class="calc-two-col">
            <div class="form-group">
              <label>Perfil de Impressora</label>
              <select id="calcPrinterProfile">
                <option value="generic">Generic Printer</option>
                <option value="prusa_mk4">Prusa MK4</option>
                <option value="bambu_x1">Bambu Lab X1</option>
                <option value="ender3">Ender 3</option>
                <option value="custom">Personalizado</option>
              </select>
            </div>
            <div class="form-group">
              <label>Peso Total (g)</label>
              <input type="number" id="calcTotalWeight" placeholder="1.00" step="0.01" min="0" value="1">
            </div>
          </div>
        </div>
      </div>

      <!-- FILAMENTS -->
      <div class="calc-card">
        <div class="calc-card-header">
          <span class="calc-card-icon">üé®</span>
          <h3>FILAMENTOS</h3>
          <div class="calc-card-header-note">Peso Total: <strong id="calcTotalWeightDisplay">1.00g</strong></div>
        </div>
        <div class="calc-card-body">
          <div id="filamentsContainer">
            <!-- Filament rows inserted by JS -->
          </div>
          <button id="addFilamentBtn" class="calc-add-btn">‚ûï Adicionar Material</button>
          <div class="calc-upgrade-note">
            ‚¨Ü Adiciona m√∫ltiplos materiais para suporte multi-material
          </div>
        </div>
      </div>

      <!-- PRINTING & LABOR TIME -->
      <div class="calc-card">
        <div class="calc-card-header">
          <span class="calc-card-icon">‚è±Ô∏è</span>
          <h3>TEMPOS</h3>
        </div>
        <div class="calc-card-body">
          <div class="calc-two-col">
            <div class="form-group">
              <label>Tempo Impress√£o (h)</label>
              <input type="number" id="calcPrintHours" value="1" min="0" step="1" class="calc-time-input">
            </div>
            <div class="form-group">
              <label>Minutos</label>
              <input type="number" id="calcPrintMins" value="1" min="0" max="59" step="1" class="calc-time-input">
            </div>
          </div>
          <div class="form-group" style="margin-top:8px">
            <label>Tempo M√£o de Obra (min)</label>
            <input type="number" id="calcLaborMins" value="1" min="0" step="1" class="calc-time-input">
          </div>
        </div>
      </div>

      <!-- COSTS -->
      <div class="calc-card">
        <div class="calc-card-header">
          <span class="calc-card-icon">üí∞</span>
          <h3>CUSTOS FIXOS</h3>
        </div>
        <div class="calc-card-body">
          <div class="calc-two-col">
            <div class="form-group">
              <label>Hardware (‚Ç¨)</label>
              <input type="number" id="calcHardwareCost" value="1" min="0" step="0.01">
            </div>
            <div class="form-group">
              <label>Embalagem (‚Ç¨)</label>
              <input type="number" id="calcPackagingCost" value="1" min="0" step="0.01">
            </div>
          </div>
          <div class="form-group">
            <label>IVA (%)</label>
            <input type="number" id="calcVatRate" value="20" min="0" max="100" step="0.5">
          </div>
        </div>
      </div>

      <!-- ADVANCED SETTINGS -->
      <div class="calc-card">
        <div class="calc-card-header">
          <span class="calc-card-icon">‚öôÔ∏è</span>
          <h3>CONFIGURA√á√ïES AVAN√áADAS</h3>
          <label class="calc-toggle-label">
            <input type="checkbox" id="advancedToggle">
            <span class="calc-toggle"></span>
          </label>
        </div>
        <div id="advancedSettingsBody" class="calc-card-body calc-advanced-body" style="display:none;">
          <div class="calc-two-col">
            <div class="form-group">
              <label>Taxa M√£o de Obra (‚Ç¨/h)</label>
              <input type="number" id="calcLaborRate" value="20" min="0" step="0.5">
            </div>
            <div class="form-group">
              <label>Fator Efici√™ncia Material</label>
              <input type="number" id="calcEfficiency" value="1.1" min="0.1" step="0.05">
            </div>
          </div>
          <div class="calc-two-col">
            <div class="form-group">
              <label>Custo Impressora (‚Ç¨)</label>
              <input type="number" id="calcPrinterCost" value="749" min="0" step="1">
            </div>
            <div class="form-group">
              <label>Custo Inicial Adicional (‚Ç¨)</label>
              <input type="number" id="calcUpfrontCost" value="0" min="0" step="1">
            </div>
          </div>
          <div class="calc-two-col">
            <div class="form-group">
              <label>Manuten√ß√£o Anual (‚Ç¨)</label>
              <input type="number" id="calcMaintenance" value="75" min="0" step="1">
            </div>
            <div class="form-group">
              <label>Vida √ötil (anos)</label>
              <input type="number" id="calcPrinterLife" value="3" min="1" step="1">
            </div>
          </div>
          <div class="calc-two-col">
            <div class="form-group">
              <label>Uptime (%)</label>
              <input type="number" id="calcUptime" value="50" min="1" max="100" step="1">
            </div>
            <div class="form-group">
              <label>Consumo Energia (W)</label>
              <input type="number" id="calcPowerW" value="150" min="0" step="10">
            </div>
          </div>
          <div class="calc-two-col">
            <div class="form-group">
              <label>Custo Energia (‚Ç¨/kWh)</label>
              <input type="number" id="calcEnergyRate" value="0.20" min="0" step="0.01">
            </div>
            <div class="form-group">
              <label>Fator Buffer</label>
              <input type="number" id="calcBufferFactor" value="1.3" min="1" step="0.05">
            </div>
          </div>

          <!-- CALCULATED METRICS -->
          <div class="calc-metrics-grid" id="calcMetrics">
            <div class="calc-metric">
              <div class="calc-metric-label">Investimento Total</div>
              <div class="calc-metric-value" id="metricTotalInvestment">749,00 ‚Ç¨</div>
            </div>
            <div class="calc-metric">
              <div class="calc-metric-label">Custo de Vida</div>
              <div class="calc-metric-value" id="metricLifetimeCost">974,00 ‚Ç¨</div>
            </div>
            <div class="calc-metric">
              <div class="calc-metric-label">Uptime Estimado</div>
              <div class="calc-metric-value highlight" id="metricUptime">4380 hrs/ano</div>
            </div>
            <div class="calc-metric">
              <div class="calc-metric-label">Deprecia√ß√£o</div>
              <div class="calc-metric-value" id="metricDepreciation">0.06 ‚Ç¨/hr</div>
            </div>
            <div class="calc-metric">
              <div class="calc-metric-label">Manuten√ß√£o</div>
              <div class="calc-metric-value" id="metricMaintenanceCost">0.02 ‚Ç¨/hr</div>
            </div>
            <div class="calc-metric calc-metric-accent">
              <div class="calc-metric-label">Custo Total Impressora</div>
              <div class="calc-metric-value" id="metricPrinterCost">0.14 ‚Ç¨/hr</div>
            </div>
          </div>
        </div>
      </div>

    </div><!-- /calc-inputs-col -->

    <!-- ===== COLUNA DIREITA: RESULTADOS ===== -->
    <div class="calc-results-col">

      <!-- SUGGESTED PRICING -->
      <div class="calc-card calc-pricing-card">
        <div class="calc-card-header">
          <span class="calc-card-icon">üíé</span>
          <h3>PRE√áOS SUGERIDOS</h3>
        </div>
        <div class="calc-card-body">
          <div class="calc-pricing-grid">
            <div class="pricing-tier competitive">
              <div class="tier-header">
                <span class="tier-icon">üåø</span>
                <span class="tier-name">COMPETITIVO</span>
                <span class="tier-price" id="priceCompetitive">3,32 ‚Ç¨</span>
              </div>
              <div class="tier-margin">25% margem de lucro</div>
              <div class="tier-vat" id="vatCompetitive">3,99 ‚Ç¨ c/ IVA</div>
            </div>
            <div class="pricing-tier standard">
              <div class="tier-header">
                <span class="tier-icon">‚≠ê</span>
                <span class="tier-name">STANDARD</span>
                <span class="tier-price" id="priceStandard">4,15 ‚Ç¨</span>
              </div>
              <div class="tier-margin">40% margem de lucro</div>
              <div class="tier-vat" id="vatStandard">4,99 ‚Ç¨ c/ IVA</div>
            </div>
            <div class="pricing-tier premium">
              <div class="tier-header">
                <span class="tier-icon">üèÜ</span>
                <span class="tier-name">PREMIUM</span>
                <span class="tier-price" id="pricePremium">6,23 ‚Ç¨</span>
              </div>
              <div class="tier-margin">60% margem de lucro</div>
              <div class="tier-vat" id="vatPremium">7,48 ‚Ç¨ c/ IVA</div>
            </div>
            <div class="pricing-tier luxury">
              <div class="tier-header">
                <span class="tier-icon">üíú</span>
                <span class="tier-name">LUXURY</span>
                <span class="tier-price" id="priceLuxury">12,46 ‚Ç¨</span>
              </div>
              <div class="tier-margin">80% margem de lucro</div>
              <div class="tier-vat" id="vatLuxury">14,96 ‚Ç¨ c/ IVA</div>
            </div>
          </div>

          <!-- CUSTOM PRICING -->
          <div class="calc-custom-pricing">
            <div class="custom-pricing-header">
              <span class="tier-icon">üéõÔ∏è</span>
              <span class="tier-name">PERSONALIZADO</span>
              <span class="tier-price" id="priceCustom">4,99 ‚Ç¨</span>
            </div>
            <div class="custom-pricing-desc">Define a tua pr√≥pria margem de lucro manualmente.</div>
            <div class="custom-slider-row">
              <input type="range" id="customMarginSlider" min="0" max="200" value="50" class="calc-slider">
              <input type="number" id="customMarginInput" value="50" min="0" max="200" class="calc-slider-num">
              <span class="calc-slider-pct">%</span>
            </div>
            <div class="custom-pricing-footer">
              <span id="customMarginLabel">50% margem de lucro</span>
              <span id="vatCustom">5,98 ‚Ç¨ c/ IVA</span>
            </div>
          </div>

          <!-- SELECTED / SAVE -->
          <div class="calc-selected-row">
            <div class="calc-selected-info">
              Selecionado: <strong id="selectedPriceDisplay">4,99 ‚Ç¨ c/ IVA</strong>
              <span id="selectedMarginDisplay" class="calc-margin-badge">40% margem</span>
            </div>
            <div class="calc-save-actions">
              <button id="saveQuoteBtn" class="btn-primary calc-save-btn">üíæ GUARDAR OR√áAMENTO</button>
              <button id="copyCalcBtn" class="btn-icon" title="Copiar">üìã</button>
              <button id="shareCalcBtn" class="btn-icon" title="Partilhar">‚Üó</button>
            </div>
          </div>
        </div>
      </div>

      <!-- COST BREAKDOWN -->
      <div class="calc-card">
        <div class="calc-card-header">
          <span class="calc-card-icon">üìä</span>
          <h3>DECOMPOSI√á√ÉO DE CUSTOS</h3>
        </div>
        <div class="calc-card-body">
          <div class="breakdown-grid">
            <div class="breakdown-item">
              <div class="breakdown-label">Custo Material</div>
              <div class="breakdown-value" id="breakdownMaterial">0,02 ‚Ç¨</div>
            </div>
            <div class="breakdown-item">
              <div class="breakdown-label">Custo Hardware</div>
              <div class="breakdown-value" id="breakdownHardware">1,00 ‚Ç¨</div>
            </div>
            <div class="breakdown-item">
              <div class="breakdown-label">Custo Embalagem</div>
              <div class="breakdown-value" id="breakdownPackaging">1,00 ‚Ç¨</div>
            </div>
            <div class="breakdown-item">
              <div class="breakdown-label">Custo M√£o de Obra</div>
              <div class="breakdown-value" id="breakdownLabor">0,33 ‚Ç¨</div>
            </div>
            <div class="breakdown-item">
              <div class="breakdown-label">Custo M√°quina</div>
              <div class="breakdown-value" id="breakdownMachine">0,14 ‚Ç¨</div>
            </div>
            <div class="breakdown-item breakdown-total">
              <div class="breakdown-label">üî¥ Custo Total Landed</div>
              <div class="breakdown-value breakdown-total-value" id="breakdownTotal">2,49 ‚Ç¨</div>
            </div>
          </div>
        </div>
      </div>

      <!-- COST ALLOCATION CHART -->
      <div class="calc-card">
        <div class="calc-card-header">
          <span class="calc-card-icon">ü•ß</span>
          <h3>ALOCA√á√ÉO DE CUSTOS</h3>
        </div>
        <div class="calc-card-body">
          <div class="calc-allocation-layout">
            <!-- Donut Chart -->
            <div class="calc-donut-wrapper">
              <svg id="costDonut" viewBox="0 0 200 200" width="200" height="200">
                <circle id="donut-bg" cx="100" cy="100" r="70" fill="none" stroke="#E0E0E0" stroke-width="30"/>
                <!-- Segments rendered by JS -->
              </svg>
              <div class="donut-center">
                <div class="donut-total-label">Total</div>
                <div class="donut-total-value" id="donutTotalValue">2,49 ‚Ç¨</div>
              </div>
            </div>
            <!-- Legend -->
            <div class="calc-legend" id="calcLegend">
              <!-- Rendered by JS -->
            </div>
          </div>
          <div class="calc-allocation-footer">
            <span>Custo Total Landed</span>
            <span id="allocationTotal">2,49 ‚Ç¨</span>
            <span id="allocationLargest" style="font-size:11px;opacity:0.7">Maior: Embalagem (40.1%)</span>
          </div>
        </div>
      </div>

      <!-- SAVED QUOTES -->
      <div class="calc-card">
        <div class="calc-card-header">
          <span class="calc-card-icon">üìÅ</span>
          <h3>OR√áAMENTOS GUARDADOS</h3>
          <button id="clearQuotesBtn" class="calc-clear-btn">Limpar</button>
        </div>
        <div class="calc-card-body" id="savedQuotesList">
          <div class="calc-empty-state">Nenhum or√ßamento guardado ainda.</div>
        </div>
      </div>

    </div><!-- /calc-results-col -->

  </div><!-- /calc-layout -->
</section>


  </main>

  <!-- =========================================================
       MODAIS DE ENCOMENDAS
       ========================================================= -->
  <div id="orderModal" class="modal hidden">
    <div class="modal-content modal-order">
      <div class="modal-header order-modal-header" id="mModalHeader">
        <div class="order-modal-header-left">
          <span class="order-modal-id" id="mOrderId">#‚Äî</span>
          <span class="order-modal-date" id="mOrderDate">‚Äî</span>
          <span class="order-modal-status-label" id="mStatusLabel">‚Äî</span>
        </div>
        <button class="modal-close" id="orderModalClose">√ó</button>
      </div>
      <div class="order-modal-body">
        <div class="order-modal-left">
          <div class="order-section"><h4 class="order-section-title">üë§ CLIENTE</h4><div id="mClientInfo"></div></div>
          <div class="order-section"><h4 class="order-section-title">üì¶ ITENS</h4><div id="mItemsList"></div></div>
        </div>
        <div class="order-modal-right">
          <div class="order-section">
            <h4 class="order-section-title">‚öôÔ∏è GERIR ENCOMENDA</h4>
            <div class="form-group">
              <label>Estado</label>
              <select id="mStatus" class="order-status-select">
                <option value="pending">‚è≥ Pendente</option>
                <option value="confirmed">‚úÖ Confirmado</option>
                <option value="printing">üñ®Ô∏è Em Impress√£o</option>
                <option value="shipped">üì¶ Enviado</option>
                <option value="delivered">üè† Entregue</option>
                <option value="cancelled">‚ùå Cancelado</option>
              </select>
            </div>
            <div class="form-group">
              <label>Transportadora</label>
              <select id="mCarrier">
                <option value="">-- Selecionar --</option>
                <option value="CTT">CTT</option><option value="DHL">DHL</option>
                <option value="DPD">DPD</option><option value="FedEx">FedEx</option>
                <option value="GLS">GLS</option><option value="UPS">UPS</option>
                <option value="Outro">Outro</option>
              </select>
            </div>
            <div class="form-group" style="margin-bottom:0">
              <label>C√≥digo de Rastreamento</label>
              <input type="text" id="mTrackingCode" placeholder="Ex: CT123456789PT" class="order-tracking-input">
            </div>
            <div id="mTrackingLink" class="tracking-link-preview" style="display:none">
              <a id="mTrackingLinkAnchor" href="#" target="_blank" rel="noopener">üîó Rastrear envio ‚Üí</a>
            </div>
          </div>
          <button class="btn-primary order-save-btn" id="mSaveBtn">üíæ GUARDAR ALTERA√á√ïES</button>
          <div class="order-ship-warning hidden" id="mShipWarning">
            ‚ö†Ô∏è Para marcar como "Enviado" √© necess√°rio inserir o c√≥digo de rastreamento.
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- =========================================================
       MODAIS DE UTILIZADORES
       ========================================================= -->
  <div id="createUserModal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header"><h3>CRIAR UTILIZADOR</h3><button class="modal-close" data-close="createUser">√ó</button></div>
      <form id="createUserForm" class="modal-form">
        <div class="form-group"><label>Nome *</label><input type="text" id="createUserName" required></div>
        <div class="form-group"><label>Email *</label><input type="email" id="createUserEmail" required></div>
        <div class="form-group">
          <label>Role *</label>
          <select id="createUserRole" required><option value="user">User</option><option value="admin">Admin</option></select>
        </div>
        <div class="form-group">
          <label>Password *</label>
          <input type="password" id="createUserPassword" required>
          <ul class="password-reqs">
            <li id="createLengthReq">‚â• 12 caracteres</li><li id="createUppercaseReq">Uma letra mai√∫scula</li>
            <li id="createLowercaseReq">Uma letra min√∫scula</li><li id="createNumberReq">Um n√∫mero</li>
            <li id="createSpecialReq">Um car√°cter especial</li>
          </ul>
        </div>
        <button type="submit" class="btn-primary">CRIAR UTILIZADOR</button>
      </form>
    </div>
  </div>

  <div id="viewUserModal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header"><h3>DETALHES DO UTILIZADOR</h3><button class="modal-close" data-close="viewUser">√ó</button></div>
      <div class="user-details">
        <div class="detail-row"><span class="detail-label">Nome:</span><span class="detail-value" id="viewUserName"></span></div>
        <div class="detail-row"><span class="detail-label">Email:</span><span class="detail-value" id="viewUserEmail"></span></div>
        <div class="detail-row"><span class="detail-label">Role:</span><span class="detail-value"><span id="viewUserRole" class="role-badge"></span></span></div>
        <div class="detail-row"><span class="detail-label">Registado em:</span><span class="detail-value" id="viewUserCreated"></span></div>
      </div>
      <div class="modal-actions">
        <button id="editUserFromViewBtn" class="btn-primary">‚úèÔ∏è EDITAR</button>
        <button id="deleteUserFromViewBtn" class="btn-danger">üóëÔ∏è ELIMINAR</button>
      </div>
    </div>
  </div>

  <div id="editUserModal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header"><h3>EDITAR UTILIZADOR</h3><button class="modal-close" data-close="editUser">√ó</button></div>
      <form id="editUserForm" class="modal-form">
        <input type="hidden" id="editUserId">
        <div class="form-group"><label>Nome *</label><input type="text" id="editUserName" required></div>
        <div class="form-group"><label>Email *</label><input type="email" id="editUserEmail" required></div>
        <div class="form-group">
          <label>Role *</label>
          <select id="editUserRole" required><option value="user">User</option><option value="admin">Admin</option></select>
        </div>
        <div class="form-group">
          <label>Nova Password (deixar vazio para n√£o alterar)</label>
          <input type="password" id="editUserPassword" placeholder="********">
          <ul class="password-reqs">
            <li id="editLengthReq">‚â• 12 caracteres</li><li id="editUppercaseReq">Uma letra mai√∫scula</li>
            <li id="editLowercaseReq">Uma letra min√∫scula</li><li id="editNumberReq">Um n√∫mero</li>
            <li id="editSpecialReq">Um car√°cter especial</li>
          </ul>
        </div>
        <button type="submit" class="btn-primary">üíæ GUARDAR ALTERA√á√ïES</button>
      </form>
    </div>
  </div>

  <!-- =========================================================
       MODAIS DE CATEGORIAS
       ========================================================= -->

  <!-- Modal: Categoria Principal -->
  <div id="primaryCategoryModal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="primaryCatModalTitle">NOVA CATEGORIA PRINCIPAL</h3>
        <button class="modal-close" data-close="primaryCat">√ó</button>
      </div>
      <form id="primaryCategoryForm" class="modal-form">
        <input type="hidden" id="primaryCatId">
        <div class="form-group">
          <label>Nome *</label>
          <input type="text" id="primaryCatName" required placeholder="Ex: Decora√ß√£o">
        </div>
        <div class="form-group">
          <label>Descri√ß√£o</label>
          <textarea id="primaryCatDesc" rows="2" placeholder="Descri√ß√£o breve desta categoria"></textarea>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>√çcone (emoji)</label>
            <input type="text" id="primaryCatIcon" placeholder="Ex: üè∫" style="font-size:20px">
          </div>
          <div class="form-group">
            <label>Ordem de exibi√ß√£o</label>
            <input type="number" id="primaryCatOrder" value="0" min="0">
          </div>
        </div>
        <button type="submit" class="btn-primary">üíæ GUARDAR</button>
      </form>
    </div>
  </div>

  <!-- Modal: Categoria Secund√°ria -->
  <div id="secondaryCategoryModal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="secondaryCatModalTitle">NOVA CATEGORIA SECUND√ÅRIA</h3>
        <button class="modal-close" data-close="secondaryCat">√ó</button>
      </div>
      <form id="secondaryCategoryForm" class="modal-form">
        <input type="hidden" id="secondaryCatId">
        <div class="form-group">
          <label>Nome *</label>
          <input type="text" id="secondaryCatName" required placeholder="Ex: PLA, Best Seller">
        </div>
        <div class="form-group">
          <label>Descri√ß√£o</label>
          <textarea id="secondaryCatDesc" rows="2" placeholder="Descri√ß√£o opcional"></textarea>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Tipo</label>
            <select id="secondaryCatRole">
              <option value="secondary">üìå Secund√°ria (material, estilo...)</option>
              <option value="tag">üè∑Ô∏è Tag (best seller, novo...)</option>
            </select>
          </div>
          <div class="form-group">
            <label>Ordem</label>
            <input type="number" id="secondaryCatOrder" value="0" min="0">
          </div>
        </div>
        <button type="submit" class="btn-primary">üíæ GUARDAR</button>
      </form>
    </div>
  </div>

  <!-- =========================================================
       MODAIS DE PRODUTOS
       ========================================================= -->

  <!-- Modal: Criar Produto -->
  <div id="createProductModal" class="modal hidden">
    <div class="modal-content modal-large">
      <div class="modal-header">
        <h3>CRIAR NOVO PRODUTO</h3>
        <button class="modal-close" data-close="create">√ó</button>
      </div>
      <form id="createProductForm" class="modal-form">

        <div class="form-row">
          <div class="form-group">
            <label>Nome *</label>
            <input type="text" id="createName" required>
          </div>
          <div class="form-group">
            <label>Pre√ßo (‚Ç¨) *</label>
            <input type="number" id="createPrice" step="0.01" required>
          </div>
        </div>

        <!-- CATEGORIA PRINCIPAL -->
        <div class="form-group">
          <label>Categoria Principal * <small style="color:#666;font-weight:normal">(obrigat√≥ria ‚Äî 1 por produto)</small></label>
          <select id="createPrimaryCategory" class="primary-cat-select" required>
            <option value="">-- Seleciona categoria principal --</option>
          </select>
        </div>

        <!-- CATEGORIAS SECUND√ÅRIAS -->
        <div class="form-group">
          <label>Categorias Secund√°rias / Tags <small style="color:#666;font-weight:normal">(opcional ‚Äî m√∫ltiplas)</small></label>
          <div id="createSecondaryCategories" class="secondary-cats-grid"></div>
        </div>

        <!-- DESCRI√á√ÉO RICH TEXT -->
        <div class="form-group">
          <label>Descri√ß√£o *</label>
          <div class="rich-editor-toolbar">
            <button type="button" onclick="document.execCommand('bold')" title="Negrito"><b>B</b></button>
            <button type="button" onclick="document.execCommand('italic')" title="It√°lico"><i>I</i></button>
            <button type="button" onclick="document.execCommand('underline')" title="Sublinhado"><u>U</u></button>
            <div class="separator"></div>
            <button type="button" onclick="document.execCommand('formatBlock', false, 'h2')" title="T√≠tulo 2">H2</button>
            <button type="button" onclick="document.execCommand('formatBlock', false, 'h3')" title="T√≠tulo 3">H3</button>
            <button type="button" onclick="document.execCommand('formatBlock', false, 'p')" title="Par√°grafo">¬∂</button>
            <div class="separator"></div>
            <button type="button" onclick="document.execCommand('insertUnorderedList')" title="Lista">‚Ä¢ Lista</button>
            <button type="button" onclick="document.execCommand('insertOrderedList')" title="Lista numerada">1. Lista</button>
            <div class="separator"></div>
            <button type="button" onclick="document.execCommand('formatBlock', false, 'blockquote')" title="Cita√ß√£o">‚ùù</button>
            <button type="button" onclick="document.execCommand('removeFormat')" title="Limpar formata√ß√£o">‚úï Fmt</button>
          </div>
          <div id="createDescEditor" class="rich-editor-content" contenteditable="true" data-placeholder="Descreve o produto..."></div>
        </div>

        <div class="form-group checkbox-group">
          <label><input type="checkbox" id="createStock"> Produto dispon√≠vel em stock</label>
        </div>

        <div class="form-group">
          <label>Modelo 3D (.glb)</label>
          <input type="file" id="createModelFile" name="modelFile" accept=".glb">
        </div>
        <div class="form-group">
          <label>Imagens (at√© 4)</label>
          <input type="file" id="createImages" name="images" accept="image/*" multiple>
        </div>

        <button type="submit" class="btn-primary">‚ûï CRIAR PRODUTO</button>
      </form>
    </div>
  </div>

  <!-- Modal: Editar Produto -->
  <div id="editProductModal" class="modal hidden">
    <div class="modal-content modal-large">
      <div class="modal-header">
        <h3>EDITAR PRODUTO: <span id="editProductName"></span></h3>
        <button class="modal-close" data-close="edit">√ó</button>
      </div>

      <div class="modal-tabs">
        <button class="modal-tab-btn active" data-tab="edit-details">üìã Detalhes</button>
        <button class="modal-tab-btn" data-tab="edit-model">üé® Modelo 3D</button>
        <button class="modal-tab-btn" data-tab="edit-images">üñºÔ∏è Imagens</button>
      </div>

      <div class="modal-tabs-container">

        <!-- ABA: DETALHES -->
        <div id="tab-edit-details" class="modal-tab-content active">
          <form id="editProductForm">
            <input type="hidden" id="editId">

            <div class="form-row">
              <div class="form-group">
                <label>Nome *</label>
                <input type="text" id="editName" required>
              </div>
              <div class="form-group">
                <label>Pre√ßo (‚Ç¨) *</label>
                <input type="number" id="editPrice" step="0.01" required>
              </div>
            </div>

            <!-- CATEGORIA PRINCIPAL -->
            <div class="form-group">
              <label>Categoria Principal * <small style="color:#666;font-weight:normal">(obrigat√≥ria ‚Äî 1 por produto)</small></label>
              <select id="editPrimaryCategory" class="primary-cat-select" required>
                <option value="">-- Seleciona categoria principal --</option>
              </select>
            </div>

            <!-- CATEGORIAS SECUND√ÅRIAS -->
            <div class="form-group">
              <label>Categorias Secund√°rias / Tags <small style="color:#666;font-weight:normal">(opcional ‚Äî m√∫ltiplas)</small></label>
              <div id="editSecondaryCategories" class="secondary-cats-grid"></div>
            </div>

            <!-- DESCRI√á√ÉO RICH TEXT -->
            <div class="form-group">
              <label>Descri√ß√£o *</label>
              <div class="rich-editor-toolbar">
                <button type="button" onclick="document.execCommand('bold')" title="Negrito"><b>B</b></button>
                <button type="button" onclick="document.execCommand('italic')" title="It√°lico"><i>I</i></button>
                <button type="button" onclick="document.execCommand('underline')" title="Sublinhado"><u>U</u></button>
                <div class="separator"></div>
                <button type="button" onclick="document.execCommand('formatBlock', false, 'h2')" title="T√≠tulo 2">H2</button>
                <button type="button" onclick="document.execCommand('formatBlock', false, 'h3')" title="T√≠tulo 3">H3</button>
                <button type="button" onclick="document.execCommand('formatBlock', false, 'p')" title="Par√°grafo">¬∂</button>
                <div class="separator"></div>
                <button type="button" onclick="document.execCommand('insertUnorderedList')" title="Lista">‚Ä¢ Lista</button>
                <button type="button" onclick="document.execCommand('insertOrderedList')" title="Lista numerada">1. Lista</button>
                <div class="separator"></div>
                <button type="button" onclick="document.execCommand('formatBlock', false, 'blockquote')" title="Cita√ß√£o">‚ùù</button>
                <button type="button" onclick="document.execCommand('removeFormat')" title="Limpar formata√ß√£o">‚úï Fmt</button>
              </div>
              <div id="editDescEditor" class="rich-editor-content" contenteditable="true"></div>
            </div>

            <div class="form-group">
              <label><input type="checkbox" id="editStock"> Stock Dispon√≠vel</label>
            </div>

            <div class="modal-actions">
              <button type="submit" class="btn-primary">üíæ GUARDAR ALTERA√á√ïES</button>
              <button type="button" id="deleteProductBtn" class="btn-danger">üóëÔ∏è ELIMINAR PRODUTO</button>
            </div>
          </form>
        </div>

        <!-- ABA: MODELO 3D -->
        <div id="tab-edit-model" class="modal-tab-content">
          <div class="model-edit-container">
            <div class="current-model">
              <h4>Modelo Atual</h4>
              <model-viewer id="editCurrentModel" src="..." alt="Modelo 3D Atual" auto-rotate camera-controls shadow-intensity="1" style="width:100%;height:400px;background-color:#2c2c2c;border-radius:8px;"></model-viewer>
              <p class="model-filename" id="currentModelFilename"></p>
            </div>
            <div class="upload-model">
              <h4>Substituir Modelo</h4>
              <div class="upload-area">
                <input type="file" id="editModelFile" accept=".glb" style="display:none;">
                <button type="button" class="btn-secondary" onclick="document.getElementById('editModelFile').click()">üìÅ Escolher Ficheiro .GLB</button>
                <p id="newModelFilename" class="file-selected"></p>
              </div>
              <button type="button" id="uploadNewModelBtn" class="btn-primary" disabled>‚¨ÜÔ∏è Enviar Novo Modelo</button>
            </div>
          </div>
        </div>

        <!-- ABA: IMAGENS -->
        <div id="tab-edit-images" class="modal-tab-content">
          <div class="current-images-section">
            <h4>Imagens Atuais (<span id="imageCount">0</span>/4)</h4>
            <div id="editImagesGrid" class="images-grid-edit"></div>
          </div>
          <div class="upload-images-section">
            <h4>Adicionar Novas Imagens</h4>
            <div class="upload-area">
              <input type="file" id="editNewImages" accept="image/*" multiple style="display:none;">
              <button type="button" class="btn-secondary" onclick="document.getElementById('editNewImages').click()">üìÅ Escolher Imagens</button>
              <p id="newImagesInfo" class="file-selected"></p>
            </div>
            <button type="button" id="uploadNewImagesBtn" class="btn-primary" disabled>‚¨ÜÔ∏è Adicionar Imagens</button>
          </div>
          <div class="replace-images-section">
            <h4>Substituir Todas as Imagens</h4>
            <div class="upload-area">
              <input type="file" id="editReplaceImages" accept="image/*" multiple style="display:none;">
              <button type="button" class="btn-secondary" onclick="document.getElementById('editReplaceImages').click()">üìÅ Escolher Novas Imagens (at√© 4)</button>
              <p id="replaceImagesInfo" class="file-selected"></p>
            </div>
            <button type="button" id="replaceAllImagesBtn" class="btn-danger" disabled>üîÑ Substituir Todas</button>
            <small class="warning-text">‚ö†Ô∏è Isto ir√° eliminar todas as imagens atuais permanentemente!</small>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- Modal: Ver Produto -->
  <div id="viewProductModal" class="modal hidden">
    <div class="modal-content modal-large">
      <div class="modal-header">
        <h3 id="viewName"></h3>
        <button class="modal-close" data-close="view">√ó</button>
      </div>

      <div class="modal-tabs">
        <button class="modal-tab-btn active" data-tab="details">üìã Detalhes</button>
        <button class="modal-tab-btn" data-tab="model">üé® Modelo 3D</button>
        <button class="modal-tab-btn" data-tab="images">üñºÔ∏è Imagens</button>
      </div>

      <div class="modal-tabs-container">

        <div id="tab-details" class="modal-tab-content active">
          <div class="product-details-grid">
            <div class="detail-row"><span class="detail-label">Pre√ßo:</span><span class="detail-value">‚Ç¨<span id="viewPrice"></span></span></div>
            <div class="detail-row"><span class="detail-label">Stock:</span><span class="detail-value"><span id="viewStock"></span></span></div>
            <div class="detail-row"><span class="detail-label">Estado:</span><span class="detail-value"><span id="viewStatus"></span></span></div>
            <div class="detail-row">
              <span class="detail-label">Categoria Principal:</span>
              <span class="detail-value" id="viewPrimaryCategory"></span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Categorias Secund√°rias:</span>
              <span class="detail-value sec-cats-view" id="viewSecondaryCategories"></span>
            </div>
            <div class="detail-row full-width">
              <span class="detail-label">Descri√ß√£o:</span>
              <div class="detail-description desc-rendered" id="viewDescription"></div>
            </div>
          </div>
        </div>

        <div id="tab-model" class="modal-tab-content">
          <div class="model-viewer-container">
            <model-viewer id="viewModel" src="..." alt="Modelo 3D" auto-rotate camera-controls shadow-intensity="1" style="width:100%;height:500px;background-color:#2c2c2c;border-radius:8px;"></model-viewer>
            <div class="model-controls"><p>üñ±Ô∏è Arrasta para rodar | üîç Scroll para zoom</p></div>
          </div>
        </div>

        <div id="tab-images" class="modal-tab-content">
          <div id="imagesGrid" class="images-grid"></div>
        </div>

      </div>
    </div>
  </div>

  <!-- =========================================================
       SCRIPTS
       ========================================================= -->
  <script src="/Dashboard/scripts/security.js"></script>
  <script src="/Dashboard/scripts/dashboard-stats.js"></script>
  <script src="/Dashboard/scripts/dashboard.js"></script>
  <script src="/Dashboard/scripts/users.js"></script>
  <script src="/Dashboard/scripts/products.js"></script>
  <script src="/Dashboard/scripts/categories.js"></script>
  <script src="/Dashboard/scripts/createproduct.js"></script>
  <script src="/Dashboard/scripts/editproduct.js"></script>
  <script src="/Dashboard/scripts/viewproduct.js"></script>
  <script src="/Dashboard/scripts/image-order-manager.js"></script>
  <script src="/Dashboard/scripts/price-calculator.js"></script>
  <script src="/Dashboard/scripts/orders.js"></script>
</body>
</html>